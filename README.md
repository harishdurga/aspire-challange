# Simple Loan API

### Software Version
- Laravel (8.49.1)
- PHP (8.0.5)

### Steps To Install The Project
1. Clone this repository
2. run `cp cp .env.example .env`
3. Update the database credentials
   ```env
    DB_CONNECTION=mysql
    DB_HOST=127.0.0.1
    DB_PORT=3306
    DB_DATABASE=aspire
    DB_USERNAME=remoteroot
    DB_PASSWORD=123456
   ``` 
4. run `composer install`
5. run `php artisan key:generate`
6. run `php artisan migrate`
7. run `php artisan db:seed`(This will add admin user into the users table as the first user) 
8. run `php artisan serve`

### Install And Run Script
After step 3 run `chmod +x install_and_run.sh` and then run `./install_and_run.sh` this perform steps from 4 to 8.

### Authentication
For Authetication *Laravel Sanctum* has been used as it's very easy to implement and suitable for apis.
#### Admin Credentials
**email**:admin@admin.com, **passowrd**:Test@2022

### Request Validation
For most of the post request validation, custom form request classes have been created to keep the controller methods clean.  `FailedValidationJsonResponse` trait has been added to all the custom form requests to be able to send response in json format in case of failed validation.

### Testing
To run tests we can either run `vendor/bin/phpunit` or `php artisan test`

### API Resources
Laravel `APIResource` and `ResourceCollection` classes have been used to transform the models and send json response.

### Model Relationships
- `TermLoan` belongs to `User`
- `TermLoan` has many `TermLoanRepayment`
- `TermLoanRepayment` belongs to `TermLoan`

### APIS
- #### Approving The Loan
Only with a token that is generated by using the admin credentials one will be able to approve/reject the loan.
The acceptable values for the `status` in the request body are `accepted` and `rejected`. And the `ref_no` is the reference number that will be in the response of apply loan.
- #### Get All Loans
Only with a token that is generated by using the admin credentials one will be able to fetch all the loans. For normal user only the loans created by the user will be fetched.
- #### Loan Details
Only with a token that is generated by using the admin credentials one will be able to fetch details of all loans where as normal user will be only able to see details of loans applied by the user.
- #### Loan Repayment
User can repay the loan till the loan amount is reached. beyond loan amount the api won't accept the payments.
- #### Apply Loan
A user can apply for the loan by passing the following data
```json
{
    "amount":15000, // loan amount
    "loan_term":7, // Loan tenure. If loan_term is 7 and repayment_freequency is weekly the the entire tenure for loan is 7 weeks.
    "repayment_freequency":"weekly" //Repayment frequency
}
```
accepted values for `repayment_freequency` are `daily`,`weekly`,`monthly` .

